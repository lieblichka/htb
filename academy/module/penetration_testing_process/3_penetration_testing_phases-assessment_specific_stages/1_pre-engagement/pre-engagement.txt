*** Pre-Engagement
Предварительная помолвка

	- Pre-engagement — это этап подготовки к фактическому тесту на проникновение.
	На этом этапе задается много вопросов и заключаются некоторые договорные
	соглашения. Клиент сообщает нам о том, что он хочет протестировать, а мы
	подробно объясняем, как сделать тест максимально эффективным.  

			~~~___ LINK ___~~~ 0-PT-Process-PRE.png

	- Весь процесс подготовки к помолвке состоит из трех основных компонентов:

    	[1] Обзорная анкета

    	[2] Встреча перед помолвкой

    	[3] Стартовая встреча

	- Прежде чем подробно обсудить любой из них, Non-Disclosure Agreement( NDA)
	должны быть подписаны всеми сторонами. Существует несколько типов NDA:

		Unilateral NDA 	
			
			Этот тип NDA обязывает только одну сторону сохранять
			конфиденциальность и позволяет другой стороне делиться полученной
			информацией с третьими лицами.

		Bilateral NDA 	

			В этом случае обе стороны обязаны сохранять
			конфиденциальность полученной и полученной информации. Это самый
			распространенный тип NDA, защищающий работу пентестеров.

		Multilateral NDA 	

			Многостороннее соглашение о неразглашении — это
			обязательство о соблюдении конфиденциальности более чем двумя сторонами.
			Если мы проводим тест на проникновение для кооперативной сети, все
			ответственные и участвующие стороны должны подписать этот документ. 


	- Исключения также могут быть сделаны в экстренных случаях, когда мы сразу
	переходим к стартовому совещанию, которое также может происходить через
	онлайн-конференцию. Важно знать who in the company is permittedчтобы
	заключить контракт с нами на тест на проникновение. Потому что мы не можем
	принять такой заказ от всех. Представьте, например, что нас нанимает
	сотрудник компании под предлогом проверки безопасности корпоративной сети.
	Однако после того, как мы закончили оценку, выяснилось, что этот сотрудник
	хотел навредить своей компании и не имел разрешения на проверку компании.
	Это поставило бы нас в критическую ситуацию с юридической точки зрения.

	Ниже приведен примерный (не исчерпывающий) список сотрудников компании,
	которым может быть разрешено нанять нас для тестирования на проникновение.
	Это может варьироваться от компании к компании, с более крупными
	организациями, не вовлекающими персонал C-уровня напрямую, и ответственность
	ложится на высшее руководство ИТ, аудита или ИТ-безопасности или тому
	подобное. 
		
		Главный исполнительный директор (CEO) 	Главный технический директор (CTO) 		Директор по информационной безопасности (CISO)
		Начальник службы безопасности (CSO) 	Директор по управлению рисками (CRO) 	Директор по информационным технологиям (CIO)
		вице-президент по внутреннему аудиту 	Менеджер по аудиту 						Вице-президент или директор по ИТ/информационной безопасности


	Крайне важно определить на ранней стадии процесса, кто имеет право подписи
	контракта, документов о правилах взаимодействия, а также кто будет основным
	и второстепенным контактным лицом, технической поддержкой и контактным лицом
	для решения любых вопросов.

	Этот этап также требует подготовки нескольких документов до проведения теста
	на проникновение, которые должны быть подписаны нашим клиентом и нами, чтобы
	при необходимости заявление о согласии могло быть представлено в письменной
	форме. Эти документы включают, но не ограничиваются: 

		
		1. Non-Disclosure Agreement( NDA) 								After Первоначальный контакт
		2. Scoping Questionnaire 										Before встреча перед помолвкой
		3. Scoping Document 											During встреча перед помолвкой
		4. Penetration Testing Proposal( Contract/Scope of Work( SoW)) 	During встреча перед помолвкой
		5. Rules of Engagement( RoE) 									Before стартовая встреча
		6. Contractors Agreement(Физические оценки) 					Beforeс тартовая встреча
		7. Reports 	Duringа также 										After проведенный тест на проникновение


	
	Примечание. Наш клиент может предоставить отдельный документ с указанием
	объема IP-адресов/диапазонов/URL-адресов и любых необходимых учетных данных,
	но эта информация также должна быть задокументирована в виде приложения в
	документе RoE.

	Важная заметка: Эти документы должны быть рассмотрены и адаптированы юристом
	после их подготовки.


	### Scoping Questionnaire
	Опросный лист
		
		- После первоначального контакта с клиентом мы обычно отправляем ему
		Scoping Questionnaireчтобы лучше понять услуги, которые они ищут. Эта
		анкета должна четко объяснять наши услуги и, как правило, может
		предлагать им выбрать один или несколько из следующего списка:

		☐ Внутренняя оценка уязвимости 				☐ Внешняя оценка уязвимости
		☐ Внутренний тест на проникновение 			☐ Внешний тест на проникновение
		☐ Оценка безопасности беспроводной сети 	☐ Оценка безопасности приложений
		☐ Оценка физической безопасности 			☐ Оценка социальной инженерии
		☐ Оценка красной команды 					☐ Оценка безопасности веб-приложений

		- В каждом из них анкета должна позволять клиенту более конкретно
		определить требуемую оценку. Нужна ли им оценка веб-приложения или
		мобильного приложения? Безопасный обзор кода? Должен ли внутренний тест
		на проникновение быть методом «черного ящика» и полууклонным? Они хотят
		только фишинговую оценку как часть оценки социальной инженерии или также
		вишинговые звонки? Это наш шанс объяснить глубину и широту наших услуг,
		убедиться, что мы понимаем потребности и ожидания наших клиентов, и
		убедиться, что мы можем адекватно предоставить необходимую им оценку.

		Помимо типа оценки, имени клиента, адреса и контактной информации
		ключевого персонала, некоторые другие важные элементы информации
		включают:
			
			Сколько ожидаемых живых хостов?
			Сколько диапазонов IP/CIDR в области действия?
			Сколько доменов/поддоменов входит в сферу действия?
			Сколько беспроводных SSID в области действия?
			Сколько веб/мобильных приложений? Если тестирование аутентифицировано, сколько ролей (обычный пользователь, администратор и т. д.)?
			Для оценки фишинга, сколько пользователей будет атаковано? Будет ли клиент предоставлять список, или мы должны будем собрать этот список через OSINT?
			Если клиент запрашивает физическую оценку, сколько мест? Если в сферу охвата входит несколько сайтов, рассредоточены ли они географически?
			Какова цель оценки Red Team? Какие-либо действия (такие как фишинг или атаки на физическую безопасность) выходят за рамки?
			Желательна ли отдельная оценка безопасности Active Directory?
			Будет ли проводиться сетевое тестирование от анонимного пользователя в сети или от обычного пользователя домена?
			Нужно ли нам обходить контроль доступа к сети (NAC)?


			Наконец, мы хотим задать вопрос о раскрытии информации и уклонении
			от нее (если это применимо к типу оценки):

				- Является ли тест на проникновение черным ящиком (информация не
				предоставлена), серым ящиком (предоставлены только диапазоны
				IP-адресов/CIDR/URL), белым ящиком (предоставлена подробная
				информация)

				- Хотели бы они, чтобы мы тестировали с неуклонного,
				гибридно-уклонного (начинайте тихо и постепенно становитесь
				«громче», чтобы оценить, на каком уровне сотрудники службы
				безопасности клиента обнаруживают наши действия) или полностью
				уклоняющегося.

			Эта информация поможет нам гарантировать, что мы назначаем
			правильные ресурсы и выполняем взаимодействие в соответствии с
			ожиданиями клиента. Эта информация также необходима для
			предоставления точного предложения со сроками проекта (например,
			оценка уязвимости займет значительно меньше времени, чем оценка
			красной команды) и стоимостью (внешний тест на проникновение против
			10 IP-адресов будет стоить значительно меньше, чем внутренний тест
			на проникновение). Протестируйте сети 30/24).

			На основе информации, полученной из анкеты, мы создаем обзор и
			обобщаем всю информацию в Scoping Document. 


	### Pre-Engagement Meeting
	Встреча перед помолвкой 
		
		- Как только у нас появится начальное представление о требованиях клиента
		к проекту, мы можем перейти к pre-engagement meeting. На этой встрече с
		заказчиком обсуждаются все важные и важные компоненты перед тестом на
		проникновение, объясняя их нашему клиенту. Информация, которую мы
		собираем на этом этапе, вместе с данными, собранными из анкеты, послужит
		входными данными для Penetration Testing Proposal, также известный как
		Contractили же Scope of Work( SoW). Мы можем рассматривать весь процесс
		как визит к врачу, чтобы получить информацию о запланированных
		обследованиях. Этот этап обычно происходит по электронной почте и во
		время онлайн-конференции или личной встречи.

			... Примечание. В ходе нашей карьеры мы можем столкнуться с
			клиентами, которые проходят свой первый в истории тест на
			проникновение, или PoC прямого клиента не знаком с процессом.
			Нередко часть встречи перед привлечением к участию используется для
			частичного или поэтапного рассмотрения анкеты.

		# Contract - Checklist
		Контракт - контрольный список

			☐ NDA 	Соглашение о неразглашении (NDA) относится к договору о
			конфиденциальности между клиентом и подрядчиком в отношении всей
			письменной или устной информации, касающейся заказа/проекта.
			Подрядчик соглашается рассматривать всю конфиденциальную информацию,
			доведенную до его сведения, как строго конфиденциальную даже после
			завершения заказа/проекта. Кроме того, любые исключения в отношении
			конфиденциальности, возможности передачи прав и обязанностей и
			договорных санкций должны быть оговорены в соглашении. Соглашение о
			неразглашении должно быть подписано до стартового совещания или,
			самое позднее, во время совещания до подробного обсуждения
			какой-либо информации.
			
			☐ Goals 	Цели — это вехи, которые должны быть достигнуты во время
			выполнения заказа/проекта. В этом процессе постановка целей
			начинается со значимых целей и продолжается мелкими и мелкими.
			
			☐ Scope 	Отдельные компоненты, подлежащие тестированию,
			обсуждаются и определяются. Это могут быть домены, диапазоны
			IP-адресов, отдельные хосты, определенные учетные записи, системы
			безопасности и т. д. Наши клиенты могут ожидать, что мы сами выясним
			тот или иной момент. Однако правовая основа для тестирования
			отдельных компонентов имеет здесь наивысший приоритет.
			
			☐ Penetration Testing Type 	При выборе типа теста на проникновение
			мы представляем отдельные варианты и объясняем их преимущества и
			недостатки. Поскольку мы уже знаем цели и сферу деятельности наших
			клиентов, мы можем и должны также дать рекомендацию о том, что мы
			советуем, и соответствующим образом обосновать нашу рекомендацию.
			Какой тип использовать в конечном итоге, решает клиент.  ☐
			Methodologies 	Примеры: OSSTMM, OWASP, автоматический и ручной
			анализ внутренних и внешних сетевых компонентов без проверки
			подлинности, оценка уязвимости сетевых компонентов и веб-приложений,
			векторизация угроз уязвимостей, проверка и использование, а также
			разработка эксплойтов для облегчения методов уклонения.  ☐
			Penetration Testing Locations 	Внешний: удаленный (через безопасный
			VPN) и/или внутренний: внутренний или удаленный (через безопасный
			VPN)
			
			☐ Time Estimation 	Для оценки времени нам нужны даты начала и
			окончания теста на проникновение. Это дает нам точное временное окно
			для выполнения теста и помогает нам планировать нашу процедуру.
			Также очень важно четко задать вопрос, в какие временные промежутки
			должны быть выполнены отдельные атаки (эксплуатация /
			пост-эксплуатация / боковое движение). Они могут выполняться как в
			рабочее, так и в нерабочее время. При тестировании в нерабочее время
			основное внимание уделяется решениям и системам безопасности,
			которые должны противостоять нашим атакам.
			
			☐ Third Parties 	Для третьих лиц необходимо определить, через
			каких сторонних поставщиков наш клиент получает услуги. Это могут
			быть облачные провайдеры, интернет-провайдеры и другие
			хостинг-провайдеры. Наш клиент должен получить письменное согласие
			от этих поставщиков, описывающее, что они согласны и осведомлены о
			том, что определенные части их услуг будут подвергнуты
			смоделированной хакерской атаке. Также настоятельно рекомендуется
			потребовать, чтобы подрядчик переслал нам разрешение третьей
			стороны, чтобы у нас было фактическое подтверждение того, что это
			разрешение действительно было получено.
			
			☐ Evasive Testing 	Обходное тестирование — это проверка обхода и
			прохождения безопасности трафика и систем безопасности в
			инфраструктуре заказчика. Мы ищем техники, которые позволяют узнать
			информацию о внутренних компонентах и атаковать их. Это зависит от
			того, хочет ли наш подрядчик, чтобы мы использовали такие методы или
			нет.
			
			☐ Risks 	Мы также должны информировать нашего клиента о рисках,
			связанных с тестами, и возможных последствиях. Основываясь на рисках
			и их потенциальной серьезности, мы можем вместе установить
			ограничения и принять определенные меры предосторожности.
			
			☐ Scope Limitations & Restrictions 	Также важно определить, какие
			серверы, рабочие станции или другие сетевые компоненты необходимы
			для надлежащего функционирования клиента и его клиентов. Нам
			придется избегать их и больше не влиять на них, так как это может
			привести к критическим техническим ошибкам, которые также могут
			повлиять на клиентов наших клиентов в производстве.
			
			☐ Information Handling 	HIPAA, PCI, HITRUST, FISMA/NIST и т. д.
			
			☐ Contact Information 	Для контактной информации нам нужно создать
			список имен, должностей, должностей, адресов электронной почты,
			номеров телефонов, служебных телефонов и порядка эскалации каждого
			человека.
			
			☐ Lines of Communication 	Также следует задокументировать, какие
			каналы связи используются для обмена информацией между клиентом и
			нами. Это может включать переписку по электронной почте, телефонные
			звонки или личные встречи.
			
			☐ Reporting 	Помимо структуры отчета, также обсуждаются любые
			специфические для клиента требования, которые отчет должен
			содержать. Кроме того, мы уточняем, как должна происходить
			отчетность и желательно ли представление результатов.
			
			☐ Payment Terms 	Наконец, разъясняются цены и условия оплаты. 

			- Наиболее важным элементом этой встречи является подробное
			представление теста на проникновение нашему клиенту и его
			направленности. Как мы уже знаем, каждая часть инфраструктуры по
			большей части уникальна, и у каждого клиента есть определенные
			предпочтения, которым они придают наибольшее значение. Выяснение
			этих приоритетов является важной частью этой встречи.

			Мы можем думать об этом как о заказе в ресторане. Если мы хотим
			стейк средней прожарки, а шеф-повар дает нам хорошо прожаренный
			стейк, потому что считает, что он лучше, это не то, на что мы
			надеялись. Поэтому мы должны отдавать предпочтение пожеланиям нашего
			клиента и подавать стейк так, как он заказал.

			На основе Contact checklistи входная информация, совместно
			используемая при определении объема, Penetration Testing Proposal(
			Contract) и связанные Rules of Engagement( RoE) создаются. 


		# Rules of Engagement - Checklist
		Правила взаимодействия — Контрольный список

			☐ Introduction 	Описание этого документа.
			
			☐ Contractor 	Название компании, ФИО подрядчика, должность.
			
			☐ Penetration Testers 	Название компании, полное имя пентестера.
			
			☐ Contact Information 	Почтовые адреса, адреса электронной почты и
			номера телефонов всех сторон-клиентов и тестеров на проникновение.
			
			☐ Purpose 	Описание цели проводимого теста на проникновение.
			
			☐ Goals 	Описание целей, которые должны быть достигнуты с помощью
			теста на проникновение.
			
			☐ Scope 	Все IP-адреса, доменные имена, URL-адреса или диапазоны
			CIDR.
			
			☐ Lines of Communication 	Онлайн-конференции, телефонные звонки,
			личные встречи или электронная почта.
			
			☐ Time Estimation 	Даты начала и окончания.
			
			☐ Time of the Day to Test 	Время суток для тестирования.
			
			☐ Penetration Testing Type 	Внешний/внутренний тест на
			проникновение/оценка уязвимостей/социальная инженерия.
			
			☐ Penetration Testing Locations 	Описание того, как
			устанавливается соединение с клиентской сетью.
			
			☐ Methodologies 	OSSTMM, PTES, OWASP и другие.
			
			☐ Objectives / Flags 	Пользователи, определенные файлы,
			определенная информация и другие.	

			☐ Evidence Handling 	Шифрование, безопасные протоколы
			
			☐ System Backups 	Файлы конфигурации, базы данных и прочее.
			
			☐ Information Handling 	Надежное шифрование данных
			
			☐ Incident Handling and Reporting 	Кейсы для контакта, прерывания
			пентеста, виды отчетов
			
			☐ Status Meetings 	Частота встреч, даты, время, включенные стороны
			
			☐ Reporting 	Тип, целевые читатели, фокус
			
			☐ Retesting 	Даты начала и окончания
			
			☐ Disclaimers and Limitation of Liability 	Повреждение системы,
			потеря данных
			
			☐ Permission to Test 	Подписанный контракт, соглашение подрядчиков 

	### Kick-Off Meeting
	Стартовая встреча
		
		The kick-off meetingобычно происходит в назначенное время и лично после
		подписания всех договорных документов. На этом совещании обычно
		присутствуют контактные лица клиента (из отдела внутреннего аудита,
		информационной безопасности, ИТ, управления и рисков и т. д., в
		зависимости от клиента), сотрудники службы технической поддержки клиента
		(разработчики, системные администраторы, сетевые инженеры и т. д.) и
		команда тестирования на проникновение (кто-то в руководящей роли
		(например, руководитель практики), фактический тестировщик(и) на
		проникновение, а иногда и менеджер проекта или даже менеджер по продажам
		или аналогичный). Мы рассмотрим характер теста на проникновение и то,
		как он будет проходить. Обычно тестирование на отказ в обслуживании
		(DoS) не проводится. Мы также объясняем, что в случае выявления
		критической уязвимости действия по тестированию на проникновение будут
		приостановлены, будет создан отчет об уведомлении об уязвимости, и
		свяжутся с экстренными контактами. Обычно они генерируются только во
		время внешних тестов на проникновение для выявления критических
		уязвимостей, таких как удаленное выполнение кода без проверки
		подлинности (RCE), SQL-инъекция или другая уязвимость, которая приводит
		к раскрытию конфиденциальных данных. Цель этого уведомления — позволить
		клиенту оценить риск внутри компании и определить, требует ли проблема
		экстренного исправления. Обычно мы останавливаем внутренний тест на
		проникновение и предупреждаем клиента только в том случае, если система
		перестает отвечать на запросы, если мы обнаруживаем доказательства
		незаконной деятельности (например, незаконное содержимое в общей папке)
		или присутствия в сети внешнего злоумышленника или предыдущего
		нарушения. .

		Объяснение процесса тестирования на проникновение дает всем участникам
		четкое представление обо всем нашем процессе. Это демонстрирует наш
		профессиональный подход и убеждает наших собеседников в том, что мы
		знаем, что делаем. Потому что помимо технического персонала, CTO и CISO,
		это будет звучать как некая магия, которую нетехническим специалистам
		очень сложно понять. Поэтому мы должны помнить о нашей аудитории и
		нацеливаться на наиболее технически неопытных задающих вопросы, чтобы
		наш подход мог следовать всем, с кем мы говорим.

		Все моменты, связанные с тестированием, необходимо обсудить и уточнить.
		Крайне важно точно реагировать на пожелания и ожидания
		заказчика/клиента. Структура и сеть каждой компании уникальны и требуют
		адаптированного подхода. У каждого клиента разные цели, и мы должны
		подстраивать наше тестирование под их пожелания. Как правило, мы можем
		увидеть, насколько опытны наши клиенты в прохождении тестов на
		проникновение в начале звонка, поэтому нам, возможно, придется сместить
		акцент, чтобы объяснить вещи более подробно и быть готовыми задать
		больше вопросов, или стартовый звонок может быть очень быстрым и
		простым. .

	### Contractors Agreement
	Соглашение с подрядчиками
		
		- Если тест на проникновение включает еще и физическое тестирование, то
		требуется дополнительное соглашение с подрядчиком. Поскольку это не
		только виртуальная среда, но и физическое вторжение, здесь действуют
		совершенно другие законы. Также возможно, что многие сотрудники не были
		проинформированы о тестировании. Предположим, мы столкнулись с
		сотрудниками с очень высоким уровнем безопасности во время физической
		атаки и попыток социальной инженерии, и нас поймали. В этом случае
		сотрудники в большинстве случаев обратятся в полицию. Это дополнительное
		contractor's agreementнаше " get out of jail free card" в таком случае.


	### Contractors Agreement - Checklist for Physical Assessments
	Соглашение с подрядчиками - Контрольный список для физической оценки

		☐ Introduction
		☐ Contractor
		☐ Purpose
		☐ Goal
		☐ Penetration Testers
		☐ Contact Information
		☐ Physical Addresses
		☐ Building Name
		☐ Floors
		☐ Physical Room Identifications
		☐ Physical Components
		☐ Timeline
		☐ Notarization
		☐ Permission to Test

	### Setting Up
	Настройка
		
		После того, как все вышеперечисленные пункты проработаны, и у нас есть
		необходимая информация, мы планируем наш подход и все готовим. Мы
		обнаружим, что результаты теста на проникновение все еще неизвестны, но
		мы можем подготовить наши виртуальные машины, VPS и другие
		инструменты/системы для всех сценариев и ситуаций. Дополнительную
		информацию и информацию о том, как подготовить эти системы, можно найти
		в « Настройка ». модуле: 
			
			https://academy.hackthebox.com/module/details/87
